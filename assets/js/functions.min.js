$(window).on("load",function(){setTimeout(function(){$("#loader").fadeOut(400,function(){$(this).remove()})},2500),$("#content, #footer").fadeTo("slow",1),$(window).width()<992&&($("#options, #search").addClass("fixed-top"),$("#options").removeClass("p-3"),$("#searchInput, #compareInput").addClass("form-control-sm"),$("#search").find(".btn").addClass("btn-sm")),$(window).resize(function(){$(window).width()<=992?($("#options, #search").addClass("fixed-top"),$("#options").removeClass("p-3"),$("#searchInput, #compareInput").addClass("form-control-sm"),$("#search").find(".btn").addClass("btn-sm")):($("#options, #search").removeClass("fixed-top"),$("#options").addClass("p-3"),$("#searchInput, #compareInput").removeClass("form-control-sm"),$("#search").find(".btn").removeClass("btn-sm"))}),Popper.Defaults.modifiers.computeStyle.enabled=!1}),$(document).ready(function(){var e=(new Date).getFullYear();document.getElementById("year").innerHTML=e;var a=new Vue({el:"#content",data:()=>({allCountries:[],country:{name:"Country",code:"Code",desc:"Enter a country name, code or capital city to display corresponding data.",flag:null,capital:"",region:"",subregion:"",area:"",borders:"",population:"",latlng:["",""],currencies:[""],languages:[""],timezones:"",wiki:!1},map:null,chartPop:null,chartArea:null,compareType:"Names",compareValue:"",compareNames:[],comparePops:[],compareAreas:[],iterator:0,utc:"",convertType:"",convertValue:"",searchValue:"",searchType:"Name",errors:[],show:0}),mounted(){this.setData(!0)},watch:{convertType:function(){if(3===this.convertType.length){var e=Object.entries(this.country.currencies).map(e=>e[0])[0],r="https://free.currencyconverterapi.com/api/v6/convert?q="+(this.convertType+"_"+e)+"&compact=y&apiKey=5a9d8f0f18bdfd2bbadd";$.get(r,function(r){var t=Object.values(r);a.convertValue="1 "+a.convertType+" = "+t[0].val.toFixed(2)+" "+e})}else a.convertValue=""}},computed:{coordinates:function(){var e=Math.round(this.country.latlng[0]),a=Math.round(this.country.latlng[1]);return(e+=e>=0?"°N":"°S")+" "+(a+=a>=0?"°E":"°W")},density:function(){var e=this.country.population,a=this.country.area;return e>0&&a>0?(e/a).toFixed(2):"Unknown"}},filters:{capitalize:function(e){return e?(e=e.toString()).replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""},addCommas:function(e){return e?e.toLocaleString():""},arrayToString:function(e){var a="";if(0===e.length)a="";else for(var r=0;r<e.length;r++)r===e.length-1?a+=e[r]:a+=e[r]+", ";return a},removeParenthesis:function(e){return e=(e=(e=(e=(e="string"==typeof e?e:e.common).replace(/\s*\(.*?\)\s*/g," ")).replace(/[)]/g,"")).replace(/\s*,\D\s*/g,", ")).replace(/\s*;\s*/g,"; ")}},methods:{setData:function(e){$.ajax({url:"https://restcountries.com/v3.1/all?fields="+["name","cca2","cca3","flags","capital","region","subregion","area","borders","population","latlng","currencies","languages","timezones"].join(","),dataType:"json",origin:"*",success:function(r){a.allCountries=r,setTimeout(()=>{r&&e&&a.random()},1e3)},error:function(){fetch("/assets/json/v3-1_filtered.json").then(e=>e.json()).then(r=>{a.allCountries=r,r&&e&&a.random()}).catch(e=>console.log(e))}})},validate:function(e){var r;return r=3===a.show?a.compareType:a.searchType,this.errors=[],e||a.errors.push("Input is required."),e.match(".*\\d.*")&&a.errors.push("Letters only."),"Name"!==r&&"Capital"!==r||e.length<3&&a.errors.push("Country names and capital cities must be 4 or more characters."),"Code"===r&&(e.length<2||e.length>3)&&a.errors.push("Code must be 2-3 characters."),!this.errors.length},getData(){var e=0;switch(a.searchValue.toUpperCase()){case"ENGLAND":case"SCOTLAND":case"WALES":a.searchValue="United Kingdom";break;case"UNITED STATES OF AMERICA":a.searchValue="United States";case"KOREA":a.searchValue="South Korea";case"EAST TIMOR":a.searchValue="Timor-Leste";break;case"UNITED STATES":case"INDIA":case"GUINEA":case"SAMOA":case"SUDAN":e=1}if(a.allCountries.length>0){var r=a.allCountries.filter(e=>"Name"===a.searchType?e.name.common.toUpperCase().includes(a.searchValue.toUpperCase()):"Code"===a.searchType?2===a.searchValue.toUpperCase().length?e.cca2.toUpperCase().includes(a.searchValue.toUpperCase()):e.cca3.toUpperCase().includes(a.searchValue.toUpperCase()):"Capital"===a.searchType&&e.capital[0]?e.capital[0].toUpperCase().includes(a.searchValue.toUpperCase()):void 0);switch(console.log("Entered country: ",r),""!==a.searchValue&&0===r.length?a.errors.push(a.searchValue.toUpperCase()+" is not valid, please ensure spelling and search type are correct."):(a.country.name=r[e].name.common,a.country.code=r[e].cca3,a.country.flag=r[e].flags.svg,a.country.capital=r[e].capital,a.country.region=r[e].region,a.country.subregion=r[e].subregion,a.country.area=r[e].area,a.country.borders=r[e].borders,a.country.population=r[e].population,a.country.latlng=r[e].latlng,a.country.currencies=r[e].currencies,a.country.languages=Object.entries(r[e].languages).map(e=>e[1]),a.country.timezones=r[e].timezones,a.country.wiki="https://en.wikipedia.org/wiki/"+r[e].name.common,a.utc=moment.utc().format("hh:mmA")),a.country.name){case"Bolivia (Plurinational State of)":a.country.name="Bolivia";break;case"Bonaire, Sint Eustatius and Saba":a.country.name="Bonaire";break;case"Virgin Islands (British)":a.country.name="British Virgin Islands";break;case"Virgin Islands (U.S.)":a.country.name="United States Virgin Islands";break;case"Brunei Darussalam":a.country.name="Brunei";break;case"Cabo Verde":a.country.name="Cape Verde";break;case"Congo (Democratic Republic of the)":case"Congo":a.country.name="Democratic Republic of the Congo";break;case"Falkland Islands (Malvinas)":a.country.name="Falkland Islands";break;case"French Southern Territories":a.country.name="French Southern and Antarctic Lands";break;case"Iran (Islamic Republic of)":a.country.name="Iran";break;case"Lao People's Democratic Republic":a.country.name="Laos";break;case"Macedonia (the former Yugoslav Republic of)":a.country.name="Republic of Macedonia";break;case"Micronesia (Federated States of)":a.country.name="Micronesia";break;case"Moldova (Republic of)":a.country.name="Moldova";break;case"Palestine, State of":a.country.name="Palestine (region)";break;case"Russian Federation":a.country.name="Russia";break;case"Saint Martin (French part)":a.country.name="Saint Martin";break;case"Sint Maarten (Dutch part)":a.country.name="Sint Maarten";break;case"Sao Tome and Principe":a.country.name="São Tomé and Príncipe";break;case"Korea (Republic of)":a.country.name="South Korea";break;case"Korea (Democratic People's Republic of)":a.country.name="North Korea";break;case"Syrian Arab Republic":a.country.name="Syria";break;case"Tanzania, United Republic of":a.country.name="Tanzania";break;case"Timor-Leste":a.country.name="East Timor";break;case"United Kingdom of Great Britain and Northern Ireland":a.country.name="United Kingdom";break;case"United States of America":a.country.name="United States";break;case"Venezuela (Bolivarian Republic of)":a.country.name="Venezuela";break;case"Georgia":a.country.name="Georgia (country)";break;case"Macao":a.country.name="Macau";break;case"Côte d'Ivoire":a.country.name="Ivory Coast";break;case"Gambia":a.country.name="The Gambia";break;case"Pitcairn":a.country.name="Pitcairn Islands";break;case"Republic of Kosovo":a.country.name="Kosovo"}$.ajax({method:"GET",url:"https://en.wikipedia.org/w/api.php",data:{action:"query",exintro:!0,explaintext:!0,exsentences:4,format:"json",origin:"*",prop:"extracts",titles:a.country.name}}).then(e=>{if(e){var r=e.query.pages,t=r[Object.keys(r)[0]].extract;t||(t="No description found, please see wiki for more information."),t=a.$options.filters.removeParenthesis(t),a.country.desc=t}})}if(a.errors.length>1)return a.show=0,!1},getMap(){if(a.errors.length>0||""===a.searchValue)return a.errors.push("Input is required."),a.show=0,!1;null!==a.map&&(a.map.off(),a.map.remove()),a.map=L.map("visualMap",{center:[51.505,-.09],zoom:3}),a.map.setView([a.country.latlng[0],a.country.latlng[1]],3),L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a.map),L.marker([a.country.latlng[0],a.country.latlng[1]]).addTo(a.map).bindPopup(a.country.name).openPopup(),setTimeout(()=>{a.map.invalidateSize()},1500),a.show=2},search:function(e){a.searchValue=a.searchValue.trim();void 0===e?this.searchValue:this.searchValue=e,a.validate(a.searchValue)&&(a.convertType="",a.getData(),setTimeout(function(){a.errors.length<1&&(2!==a.show?a.show=1:setTimeout(function(){a.getMap()},500))},500))},compare(){a.iterator=0,a.compareNames=[],a.comparePops=[],a.compareAreas=[];for(var e=a.compareValue.split(","),r=null,t=0;t<e.length;t++)if(!1===a.validate(e[t].toUpperCase().trim()))return!1;null!==a.chartPop&&null!==a.chartArea&&(a.chartPop.destroy(),a.chartArea.destroy());var o=document.getElementById("chartPop").getContext("2d"),n=document.getElementById("chartArea").getContext("2d");a.chartPop=new Chart(o,{type:"bar",responsive:!0,data:{labels:a.compareNames,datasets:[{label:"Population (Bar)",data:a.comparePops,borderWidth:1,borderColor:"#1a1a1a",hoverBackgroundColor:"rgba(0,0,0,0.5)"},{label:"Population (Line)",data:a.comparePops,type:"line",backgroundColor:"#1a1a1a",borderColor:"#1a1a1a",fill:"transparent"}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,callback:function(e){return a.$options.filters.addCommas(e)}}}]}}}),a.chartArea=new Chart(n,{type:"bar",responsive:!0,data:{labels:a.compareNames,datasets:[{label:"Area (Bar)",data:a.compareAreas,borderWidth:1,borderColor:"#1a1a1a",hoverBackgroundColor:"rgba(0,0,0,0.5)"},{label:"Area (Line)",data:a.compareAreas,type:"line",backgroundColor:"#1a1a1a",borderColor:"#1a1a1a",fill:"transparent"}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,callback:function(e){return a.$options.filters.addCommas(e)+" km²"}}}]}}});for(var s=function(){var t=e[a.iterator].toUpperCase().trim();return 0===(r=a.allCountries.filter(function(e){return"Names"===a.compareType?e.name.common.toUpperCase().includes(t):"Codes"===a.compareType?2===compare.length?e.cca2.toUpperCase().includes(t):e.cca3.toUpperCase().includes(t):void 0})).length?(a.errors.push(t+" is not valid, please ensure spelling and search type are correct."),!1):-1!==a.compareNames.indexOf(r[0].name)?0:(a.compareNames.push(r[0].name.common),a.comparePops.push(r[0].population),void a.compareAreas.push(r[0].area))};a.iterator<e.length;)!1!==s()&&(a.chartPop.update(),a.chartArea.update(),$("#compare").find(".desc").css("display","inline")),a.iterator=a.iterator+1},random(){var e=Math.floor(Math.random()*a.allCountries.length-1+1),r=a.allCountries[e].name.common;a.searchType="Name",a.search(r)},clear(){null!==a.map&&(a.map.off(),a.map.remove()),null!==a.chartPop&&($("#compare").find(".desc").css("display","none"),a.chartPop.destroy(),a.chartArea.destroy());var e=a.show;Object.assign(this.$data,this.$options.data()),this.setData(!1),a.show=e<3?0:3}}});$(".expand").on("click",function(){var e=$(this).closest("div");$(this).toggleClass("fa-expand fa-compress"),e.hasClass("col-12")?setTimeout(function(){e.siblings().toggleClass("d-none")},350):e.siblings().toggleClass("d-none"),e.toggleClass("col-lg-6 col-12 px-3")})});